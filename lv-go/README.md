# lv-go - Logstash to Vector Migration Tool

A command-line tool for migrating Logstash configurations to Vector format, written in Go.

## Features

- **Automatic Migration**: Converts Logstash `.conf` files to Vector `.toml` format
- **Plugin Support**: Transforms 7 common Logstash plugins:
  - **Inputs**: file, beats
  - **Filters**: grok, mutate, date
  - **Outputs**: elasticsearch, file
- **Unsupported Plugin Handling**: Creates TODO markers with migration guidance
- **Validation**: Integrates with `vector validate` CLI
- **Detailed Reports**: Generates comprehensive migration reports in Markdown
- **Dry-Run Mode**: Preview migrations without writing files
- **Comparison Tool**: Side-by-side comparison of Logstash and Vector configs

## Installation

### From Source

```bash
cd lv-go
go build -o lv-go ./cmd/lv-go
sudo mv lv-go /usr/local/bin/
```

### Using Go Install

```bash
go install github.com/yourusername/lv-go/cmd/lv-go@latest
```

## Usage

### Migrate Command

Migrate all Logstash configurations in a directory:

```bash
# Basic migration
lv-go migrate /path/to/logstash/configs

# Dry run (preview without writing files)
lv-go migrate --dry-run /path/to/logstash/configs

# Custom output directory
lv-go migrate --output-dir ./vector-configs /path/to/logstash/configs

# Skip validation
lv-go migrate --validate=false /path/to/logstash/configs

# Verbose output
lv-go migrate --verbose /path/to/logstash/configs

# Quiet mode
lv-go migrate --quiet /path/to/logstash/configs

# Overwrite without confirmation
lv-go migrate --overwrite /path/to/logstash/configs
```

### Validate Command

Validate Vector TOML files:

```bash
# Validate specific files
lv-go validate config1.toml config2.toml

# Validate all .toml files in current directory
lv-go validate
```

### Diff Command

Compare Logstash and Vector configurations:

```bash
lv-go diff logstash.conf vector.toml

# Verbose mode shows config details
lv-go diff --verbose logstash.conf vector.toml
```

## Examples

### Example 1: Simple File Input to Output

**Logstash (`input.conf`):**
```ruby
input {
  file {
    path => "/var/log/app.log"
    start_position => "beginning"
  }
}

output {
  file {
    path => "/var/log/output.log"
    codec => "json_lines"
  }
}
```

**Vector (`input.toml`):**
```toml
# Generated by lv-go - Logstash to Vector Migration Tool
# Source: input.conf

[sources.file_source_0]
type = "file"
include = ["/var/log/app.log"]
read_from = "beginning"

[sinks.file_sink_0]
type = "file"
inputs = ["file_source_0"]
path = "/var/log/output.log"

[sinks.file_sink_0.encoding]
codec = "json"
```

### Example 2: Complex Pipeline with Filters

**Logstash (`pipeline.conf`):**
```ruby
input {
  file {
    path => "/var/log/app.log"
  }
}

filter {
  grok {
    match => { "message" => "%{COMBINEDAPACHELOG}" }
  }

  mutate {
    remove_field => ["temp"]
  }

  date {
    match => ["timestamp", "ISO8601"]
    target => "@timestamp"
  }
}

output {
  elasticsearch {
    hosts => ["localhost:9200"]
    index => "logs-%{+YYYY.MM.dd}"
  }
}
```

**Vector (`pipeline.toml`):**
```toml
# Generated by lv-go - Logstash to Vector Migration Tool
# Source: pipeline.conf

[sources.file_source_0]
type = "file"
include = ["/var/log/app.log"]
read_from = "end"

[transforms.grok_transform_0]
type = "remap"
inputs = ["file_source_0"]
source = '''
. = parse_groks!(.message, ["%{COMBINEDAPACHELOG}"])
'''

[transforms.mutate_transform_1]
type = "remap"
inputs = ["grok_transform_0"]
source = '''
del(.temp)
'''

[transforms.date_transform_2]
type = "remap"
inputs = ["mutate_transform_1"]
source = '''
.@timestamp = parse_timestamp!(.timestamp, format: "%+")
'''

[sinks.elasticsearch_sink_0]
type = "elasticsearch"
inputs = ["date_transform_2"]
endpoints = ["http://localhost:9200"]
mode = "bulk"
# TODO: Convert Logstash index template 'logs-%{+YYYY.MM.dd}' to Vector format
index = "logs"
```

## Supported Plugins

### Input Plugins

| Logstash Plugin | Vector Component | Notes |
|-----------------|------------------|-------|
| `file` | `file` source | Maps `path` → `include`, `start_position` → `read_from` |
| `beats` | `socket` source | Uses TCP mode, see migration report for guidance |

### Filter Plugins

| Logstash Plugin | Vector Component | Notes |
|-----------------|------------------|-------|
| `grok` | `remap` transform | Converts to `parse_groks!()` VRL function |
| `mutate` | `remap` transform | Converts operations to VRL (`del()`, field assignments) |
| `date` | `remap` transform | Converts to `parse_timestamp!()` VRL function |

### Output Plugins

| Logstash Plugin | Vector Component | Notes |
|-----------------|------------------|-------|
| `elasticsearch` | `elasticsearch` sink | Maps hosts, auth; index templates require manual review |
| `file` | `file` sink | Maps path, codec |

## Migration Reports

Each migration generates a detailed report (`migration-report.md`) containing:

- Overall success rate
- Successfully migrated plugins
- Unsupported plugins with migration guidance
- Errors and warnings
- Original Logstash configurations for unsupported plugins
- Links to Vector documentation

## Requirements

- Go 1.21 or later
- Vector CLI (optional, for validation)

## Development

### Build

```bash
make build
```

### Test

```bash
make test
```

### Run

```bash
make run
```

### Install

```bash
make install
```

## Project Structure

```
lv-go/
├── cmd/
│   └── lv-go/           # Main entry point
├── internal/
│   ├── cli/             # CLI commands
│   ├── generator/       # TOML generation
│   ├── models/          # Data structures
│   ├── parser/          # Logstash DSL parser
│   ├── report/          # Report generation
│   ├── transformer/     # Plugin transformers
│   ├── utils/           # Utility functions
│   └── validator/       # Vector validation
├── pkg/
│   └── api/             # Public API
├── testdata/            # Test fixtures
├── go.mod
├── go.sum
├── Makefile
└── README.md
```

## Contributing

Contributions are welcome! Please feel free to submit pull requests or open issues.

## License

MIT License

## Credits

Go implementation of the [lv-py](../lv-py) Python tool.
