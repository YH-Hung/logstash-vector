[sources.file_input]
type = "file"
include = ["/var/log/app.log"]
read_from = "beginning"

# TODO: Manual migration required for unsupported plugin 'kafka' (input)
# Original Logstash configuration:
#   kafka {
#     bootstrap_servers => "localhost:9092"
#     topics => ["events"]
#   }
#
# Vector alternatives to consider:
#   - kafka source: https://vector.dev/docs/reference/configuration/sources/kafka/
#
# Manual migration guidance:
#   The Logstash kafka input can be migrated to Vector's kafka source.
#   Update the configuration below with the correct kafka settings.

[sources.kafka_input_placeholder]
type = "kafka"
# FIXME: Configure kafka source settings
# bootstrap_servers = "localhost:9092"
# topics = ["events"]

[transforms.grok_filter]
type = "remap"
inputs = ["file_input", "kafka_input_placeholder"]
source = '''
parsed, err = parse_groks(.message, patterns: ["%{COMBINEDAPACHELOG}"])
if err == null {
  . = merge(., parsed)
}
'''

# TODO: Manual migration required for unsupported plugin 'ruby' (filter)
# Original Logstash configuration:
#   ruby {
#     code => "event.set('timestamp_ms', (Time.now.to_f * 1000).to_i)"
#   }
#
# Vector alternatives to consider:
#   - remap transform with VRL: https://vector.dev/docs/reference/vrl/
#
# Manual migration guidance:
#   The Logstash ruby filter executes custom Ruby code for event processing.
#   In Vector, use the 'remap' transform with VRL (Vector Remap Language) to achieve similar functionality.
#
# Example VRL code for the above Ruby filter:
#   .timestamp_ms = to_unix_timestamp(now(), unit: "milliseconds")

[transforms.ruby_filter_placeholder]
type = "remap"
inputs = ["grok_filter"]
source = '''
# FIXME: Implement VRL transformation
# .timestamp_ms = to_unix_timestamp(now(), unit: "milliseconds")
'''

[transforms.mutate_filter]
type = "remap"
inputs = ["ruby_filter_placeholder"]
source = '''
.environment = "production"
'''

[sinks.elasticsearch_output]
type = "elasticsearch"
inputs = ["mutate_filter"]
endpoints = ["http://localhost:9200"]
mode = "bulk"
bulk.index = "app-logs-%Y.%m.%d"
